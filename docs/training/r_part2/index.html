<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Mark Dunning">
<meta name="dcterms.date" content="2025-10-10">

<title>Introduction to R - Part 2 ‚Äì Dr.&nbsp;Mark Dunning - Bioinformatician / Data Scientist</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark-2fef5ea3f8957b3e4ecc936fc74692ca.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-1688d9e1630bd0bcb1ec498477fd8fb7.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-96TB60ETKS"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-96TB60ETKS', { 'anonymize_ip': true});
</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Dr.&nbsp;Mark Dunning - Bioinformatician / Data Scientist</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../cv.html"> 
<span class="menu-text">CV</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../training.html"> 
<span class="menu-text">Training Materials</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview">Overview</a>
  <ul class="collapse">
  <li><a href="#topics-covered" id="toc-topics-covered" class="nav-link" data-scroll-target="#topics-covered">Topics covered</a></li>
  </ul></li>
  <li><a href="#data-manipulation" id="toc-data-manipulation" class="nav-link" data-scroll-target="#data-manipulation">Data Manipulation</a>
  <ul class="collapse">
  <li><a href="#manipulating-columns" id="toc-manipulating-columns" class="nav-link" data-scroll-target="#manipulating-columns">Manipulating Columns</a>
  <ul class="collapse">
  <li><a href="#selecting-columns" id="toc-selecting-columns" class="nav-link" data-scroll-target="#selecting-columns"><code>select</code>ing columns</a></li>
  </ul></li>
  <li><a href="#restricting-rows-with-filter" id="toc-restricting-rows-with-filter" class="nav-link" data-scroll-target="#restricting-rows-with-filter">Restricting rows with filter</a>
  <ul class="collapse">
  <li><a href="#testing-more-than-one-condition" id="toc-testing-more-than-one-condition" class="nav-link" data-scroll-target="#testing-more-than-one-condition">testing more than one condition</a></li>
  </ul></li>
  <li><a href="#exercise" id="toc-exercise" class="nav-link" data-scroll-target="#exercise">Exercise</a></li>
  <li><a href="#manipulating-the-values-in-a-column-creating-new-columns" id="toc-manipulating-the-values-in-a-column-creating-new-columns" class="nav-link" data-scroll-target="#manipulating-the-values-in-a-column-creating-new-columns">Manipulating the values in a column / creating new columns</a></li>
  <li><a href="#ordering-sorting" id="toc-ordering-sorting" class="nav-link" data-scroll-target="#ordering-sorting">Ordering / sorting</a></li>
  <li><a href="#saving-data-frames" id="toc-saving-data-frames" class="nav-link" data-scroll-target="#saving-data-frames">Saving data frames</a></li>
  <li><a href="#exercise-1" id="toc-exercise-1" class="nav-link" data-scroll-target="#exercise-1">Exercise</a></li>
  <li><a href="#piping" id="toc-piping" class="nav-link" data-scroll-target="#piping">‚ÄúPiping‚Äù</a></li>
  </ul></li>
  <li><a href="#plotting" id="toc-plotting" class="nav-link" data-scroll-target="#plotting">Plotting</a>
  <ul class="collapse">
  <li><a href="#why-use-ggplot2" id="toc-why-use-ggplot2" class="nav-link" data-scroll-target="#why-use-ggplot2">Why use ggplot2?</a></li>
  <li><a href="#basic-plot-types" id="toc-basic-plot-types" class="nav-link" data-scroll-target="#basic-plot-types">Basic plot types</a>
  <ul class="collapse">
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises">Exercises</a></li>
  </ul></li>
  <li><a href="#customising-the-plot-appearance" id="toc-customising-the-plot-appearance" class="nav-link" data-scroll-target="#customising-the-plot-appearance">Customising the plot appearance</a></li>
  <li><a href="#wrap-up" id="toc-wrap-up" class="nav-link" data-scroll-target="#wrap-up">Wrap-up</a></li>
  <li><a href="#bonus-exercise" id="toc-bonus-exercise" class="nav-link" data-scroll-target="#bonus-exercise">Bonus Exercise</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Introduction to R - Part 2</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Mark Dunning </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 10, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="overview" class="level1">
<h1>Overview</h1>
<p>Starting to play with data with the <code>dplyr</code> and <code>ggplot2</code> packages</p>
<section id="topics-covered" class="level2">
<h2 class="anchored" data-anchor-id="topics-covered">Topics covered</h2>
<ul>
<li>Choosing which columns to show from the data</li>
<li>Choosing what rows to keep in the data</li>
<li>Adding / altering columns</li>
<li>Sorting the rows in our data</li>
<li>Introduction to plotting</li>
</ul>
</section>
</section>
<section id="data-manipulation" class="level1">
<h1>Data Manipulation</h1>
<p>If you followed the first part, you should already have some example data downloaded. The command to do this is repeated below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Checks if the required file is present, and downloads if not</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(<span class="st">"raw_data/gapminder.csv"</span>)) {</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dir.create</span>(<span class="st">"raw_data/"</span>,<span class="at">showWarnings =</span> <span class="cn">FALSE</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(<span class="st">"https://raw.githubusercontent.com/markdunning/markdunning.github.com/refs/heads/master/files/training/r/raw_data/gapminder.csv"</span>, <span class="at">destfile =</span> <span class="st">"raw_data/gapminder.csv"</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We also discussed in the previous part how to read the example dataset into R.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>gapminder <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"raw_data/gapminder.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="manipulating-columns" class="level2">
<h2 class="anchored" data-anchor-id="manipulating-columns">Manipulating Columns</h2>
<p>We are going to use functions from the <strong><code>dplyr</code></strong> package to <strong>manipulate the data frame</strong> we have just created. It is perfectly possible to work with data frames using the functions provided as part of ‚Äú<em>base R</em>‚Äù. However, many find it easy to read and write code using <code>dplyr</code>.</p>
<p>There are <strong>many more functions available in <code>dplyr</code></strong> than we will cover today. An overview of all functions is given in a cheatsheet.</p>
<div class="callout callout-style-simple callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Help with dplyr functions
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><a href="https://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf">dplyr cheatsheet</a>. The ‚Äúcheatsheet‚Äù is also available through the RStudio Help menu. However, I don‚Äôt think of this as cheating to have such information to hand. There are far too many functions to remember all of them!</li>
</ul>
</div>
</div>
<p>Before using any of these functions, we need to load the library:-</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="selecting-columns" class="level3">
<h3 class="anchored" data-anchor-id="selecting-columns"><code>select</code>ing columns</h3>
<p>We can <strong>access the columns</strong> of a data frame using the <code>select</code> function. This lets us have control over what is printed to the screen. Admitedly the dataset we are using here is rather small (being only six columns), but these useful functions really shine when faced with 10s or 100s of columns</p>
<section id="by-name" class="level4">
<h4 class="anchored" data-anchor-id="by-name">by name</h4>
<p>Firstly, we can select column by name, by adding bare column names (i.e.&nbsp;not requiring quote marks around the name) after the name of the data frame, separated by a <code>,</code> .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(gapminder, country, continent)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 862 √ó 2
   country     continent
   &lt;chr&gt;       &lt;chr&gt;    
 1 Afghanistan Asia     
 2 Afghanistan Asia     
 3 Afghanistan Asia     
 4 Afghanistan Asia     
 5 Afghanistan Asia     
 6 Afghanistan Asia     
 7 Afghanistan Asia     
 8 Afghanistan Asia     
 9 Afghanistan Asia     
10 Afghanistan Asia     
# ‚Ñπ 852 more rows</code></pre>
</div>
</div>
<p>Now lets imagine that we want to see all the columns <em>apart from <code>country</code></em>. It would quickly become tedious, not to mention and prone to error, if we had to type every column name we wanted to keep by-hand.</p>
<p>Thankfully, we can also omit columns from the ouput by putting a minus (<code>-</code>) in front of the column name. Note that this is not the same as removing the column from the data permanently.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(gapminder, <span class="sc">-</span>country)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 862 √ó 5
   continent  year lifeExp      pop gdpPercap
   &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
 1 Asia       1952    28.8  8425333      779.
 2 Asia       1957    30.3  9240934      821.
 3 Asia       1962    32.0 10267083      853.
 4 Asia       1967    34.0 11537966      836.
 5 Asia       1972    36.1 13079460      740.
 6 Asia       1977    38.4 14880372      786.
 7 Asia       1982    39.9 12881816      978.
 8 Asia       1987    40.8 13867957      852.
 9 Asia       1992    41.7 16317921      649.
10 Asia       1997    41.8 22227415      635.
# ‚Ñπ 852 more rows</code></pre>
</div>
</div>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>The <code>dplyr</code> package has been carefully developed over the years with the needs of the data analyst in mind. Ideally we would rather be spending our time exploring and understanding data than writing reams of code. For this reason, you will often find a helpful function for a common task.</p>
<p>If you find yourself having to write lots of code to achieve a data manipulation task, the chances are the a convenient function already exists.</p>
</div>
</div>
</div>
</section>
<section id="range-of-columns" class="level4">
<h4 class="anchored" data-anchor-id="range-of-columns">range of columns</h4>
<p>A range of columns can be selected by the <code>:</code> operator.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(gapminder, lifeExp<span class="sc">:</span>gdpPercap)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 862 √ó 3
   lifeExp      pop gdpPercap
     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
 1    28.8  8425333      779.
 2    30.3  9240934      821.
 3    32.0 10267083      853.
 4    34.0 11537966      836.
 5    36.1 13079460      740.
 6    38.4 14880372      786.
 7    39.9 12881816      978.
 8    40.8 13867957      852.
 9    41.7 16317921      649.
10    41.8 22227415      635.
# ‚Ñπ 852 more rows</code></pre>
</div>
</div>
</section>
<section id="helper-functions" class="level4">
<h4 class="anchored" data-anchor-id="helper-functions">helper functions</h4>
<p>There are a number of helper functions can be employed if we are unsure about the exact name of the column.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(gapminder, <span class="fu">starts_with</span>(<span class="st">"co"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 862 √ó 2
   country     continent
   &lt;chr&gt;       &lt;chr&gt;    
 1 Afghanistan Asia     
 2 Afghanistan Asia     
 3 Afghanistan Asia     
 4 Afghanistan Asia     
 5 Afghanistan Asia     
 6 Afghanistan Asia     
 7 Afghanistan Asia     
 8 Afghanistan Asia     
 9 Afghanistan Asia     
10 Afghanistan Asia     
# ‚Ñπ 852 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(gapminder, <span class="fu">contains</span>(<span class="st">"life"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 862 √ó 1
   lifeExp
     &lt;dbl&gt;
 1    28.8
 2    30.3
 3    32.0
 4    34.0
 5    36.1
 6    38.4
 7    39.9
 8    40.8
 9    41.7
10    41.8
# ‚Ñπ 852 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># selecting the last and penultimate columns</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(gapminder, <span class="fu">last_col</span>(<span class="dv">1</span>),<span class="fu">last_col</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 862 √ó 2
        pop gdpPercap
      &lt;dbl&gt;     &lt;dbl&gt;
 1  8425333      779.
 2  9240934      821.
 3 10267083      853.
 4 11537966      836.
 5 13079460      740.
 6 14880372      786.
 7 12881816      978.
 8 13867957      852.
 9 16317921      649.
10 22227415      635.
# ‚Ñπ 852 more rows</code></pre>
</div>
</div>
<p>It is also possible to use the column number in the selection.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(gapminder, <span class="dv">4</span><span class="sc">:</span><span class="dv">6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 862 √ó 3
   lifeExp      pop gdpPercap
     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
 1    28.8  8425333      779.
 2    30.3  9240934      821.
 3    32.0 10267083      853.
 4    34.0 11537966      836.
 5    36.1 13079460      740.
 6    38.4 14880372      786.
 7    39.9 12881816      978.
 8    40.8 13867957      852.
 9    41.7 16317921      649.
10    41.8 22227415      635.
# ‚Ñπ 852 more rows</code></pre>
</div>
</div>
<p>The <code>select</code> function can be used with just a single column name - in a similar manner to the <code>$</code> operation we saw in <a href="../..\training/r_part1/index.html#accessing-data-in-columns">Part 1</a>. However, <code>select</code> always returns a <em>data frame</em> whereas <code>$</code> gives a vector. Compare the output of the following code chunks</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(gapminder, pop)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 862 √ó 1
        pop
      &lt;dbl&gt;
 1  8425333
 2  9240934
 3 10267083
 4 11537966
 5 13079460
 6 14880372
 7 12881816
 8 13867957
 9 16317921
10 22227415
# ‚Ñπ 852 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>gapminder<span class="sc">$</span>pop</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The consequence of this is that you cannot use functions such as <code>mean</code> in combination with <code>select</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>pops <span class="ot">&lt;-</span> <span class="fu">select</span>(gapminder, pop)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(pops)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In the next session we will see how to calculate summary statistics on particular columns in our data. For now, a useful function is <code>pull</code> that will return the correct type of data required for a function such as <code>mean</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>pops <span class="ot">&lt;-</span> <span class="fu">pull</span>(gapminder,pop)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(pops)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 40918865</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="restricting-rows-with-filter" class="level2">
<h2 class="anchored" data-anchor-id="restricting-rows-with-filter">Restricting rows with filter</h2>
<p>So far we have been returning all the rows in the output. We can use what we call a <strong>logical test</strong> to <strong>filter the rows</strong> in a data frame. This logical test will be applied to each row and give either a <code>TRUE</code> or <code>FALSE</code> result. When filtering, <strong>only rows with a <code>TRUE</code> result get returned</strong>.</p>
<p>For example we filter for rows where the <code>lifeExp</code> variable is less than 40. You can think of R looking at each row of the data frame in turn and deciding whether the <code>lifeExp</code> value in that row is less than 40. If so, that row will be shown on the screen.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(gapminder, lifeExp <span class="sc">&lt;</span> <span class="dv">40</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 65 √ó 6
   country     continent  year lifeExp      pop gdpPercap
   &lt;chr&gt;       &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
 1 Afghanistan Asia       1952    28.8  8425333      779.
 2 Afghanistan Asia       1957    30.3  9240934      821.
 3 Afghanistan Asia       1962    32.0 10267083      853.
 4 Afghanistan Asia       1967    34.0 11537966      836.
 5 Afghanistan Asia       1972    36.1 13079460      740.
 6 Afghanistan Asia       1977    38.4 14880372      786.
 7 Afghanistan Asia       1982    39.9 12881816      978.
 8 Angola      Africa     1952    30.0  4232095     3521.
 9 Angola      Africa     1957    32.0  4561361     3828.
10 Angola      Africa     1962    34    4826015     4269.
# ‚Ñπ 55 more rows</code></pre>
</div>
</div>
<p>Testing for equality can be done using <code>==</code>. This will only give <code>TRUE</code> for entries that are <em>exactly</em> the same as the test string.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(gapminder, country <span class="sc">==</span> <span class="st">"Zambia"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 0 √ó 6
# ‚Ñπ 6 variables: country &lt;chr&gt;, continent &lt;chr&gt;, year &lt;dbl&gt;, lifeExp &lt;dbl&gt;,
#   pop &lt;dbl&gt;, gdpPercap &lt;dbl&gt;</code></pre>
</div>
</div>
<p>N.B. For partial matches, the <code>grepl</code> function and / or <em>regular expressions</em> (if you know them) can be used.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(gapminder, <span class="fu">grepl</span>(<span class="st">"land"</span>, country))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 36 √ó 6
   country continent  year lifeExp     pop gdpPercap
   &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;
 1 Finland Europe     1952    66.6 4090500     6425.
 2 Finland Europe     1957    67.5 4324000     7545.
 3 Finland Europe     1962    68.8 4491443     9372.
 4 Finland Europe     1967    69.8 4605744    10922.
 5 Finland Europe     1972    70.9 4639657    14359.
 6 Finland Europe     1977    72.5 4738902    15605.
 7 Finland Europe     1982    74.6 4826933    18533.
 8 Finland Europe     1987    74.8 4931729    21141.
 9 Finland Europe     1992    75.7 5041039    20647.
10 Finland Europe     1997    77.1 5134406    23724.
# ‚Ñπ 26 more rows</code></pre>
</div>
</div>
<p>We can also test if rows are <em>not</em> equal to a value using <code>!=</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(gapminder, continent <span class="sc">!=</span> <span class="st">"Europe"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 670 √ó 6
   country     continent  year lifeExp      pop gdpPercap
   &lt;chr&gt;       &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
 1 Afghanistan Asia       1952    28.8  8425333      779.
 2 Afghanistan Asia       1957    30.3  9240934      821.
 3 Afghanistan Asia       1962    32.0 10267083      853.
 4 Afghanistan Asia       1967    34.0 11537966      836.
 5 Afghanistan Asia       1972    36.1 13079460      740.
 6 Afghanistan Asia       1977    38.4 14880372      786.
 7 Afghanistan Asia       1982    39.9 12881816      978.
 8 Afghanistan Asia       1987    40.8 13867957      852.
 9 Afghanistan Asia       1992    41.7 16317921      649.
10 Afghanistan Asia       1997    41.8 22227415      635.
# ‚Ñπ 660 more rows</code></pre>
</div>
</div>
<section id="testing-more-than-one-condition" class="level3">
<h3 class="anchored" data-anchor-id="testing-more-than-one-condition">testing more than one condition</h3>
<p>There are a couple of ways of testing for more than one pattern. The first uses an <em>or</em> <code>|</code> statement. i.e.&nbsp;testing if the value of <code>country</code> is <code>Zambia</code> <em>or</em> the value is <code>Zimbabwe</code>. Remember to use double <code>=</code> sign to test for string equality; <code>==</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(gapminder, country <span class="sc">==</span> <span class="st">"Zambia"</span> <span class="sc">|</span> country <span class="sc">==</span> <span class="st">"Zimbabwe"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 0 √ó 6
# ‚Ñπ 6 variables: country &lt;chr&gt;, continent &lt;chr&gt;, year &lt;dbl&gt;, lifeExp &lt;dbl&gt;,
#   pop &lt;dbl&gt;, gdpPercap &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
The difference between ‚Äú<strong>and</strong>‚Äù and ‚Äú<strong>or</strong>‚Äù
</div>
</div>
<div class="callout-body-container callout-body">
<p>Consider the following code. Is the output as you expect? ü§î</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(gapminder, country <span class="sc">==</span> <span class="st">"Zambia"</span>, country <span class="sc">==</span> <span class="st">"Zimbabwe"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 0 √ó 6
# ‚Ñπ 6 variables: country &lt;chr&gt;, continent &lt;chr&gt;, year &lt;dbl&gt;, lifeExp &lt;dbl&gt;,
#   pop &lt;dbl&gt;, gdpPercap &lt;dbl&gt;</code></pre>
</div>
</div>
</div>
</div>
<p>The <code>%in%</code> function is a convenient function for testing which items in a vector correspond to a defined set of values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(gapminder, country <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Zambia"</span>, <span class="st">"Zimbabwe"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 0 √ó 6
# ‚Ñπ 6 variables: country &lt;chr&gt;, continent &lt;chr&gt;, year &lt;dbl&gt;, lifeExp &lt;dbl&gt;,
#   pop &lt;dbl&gt;, gdpPercap &lt;dbl&gt;</code></pre>
</div>
</div>
<p>We can require that two or more tests are <code>TRUE</code>, e.g.&nbsp;which years in Zambia had a life expectancy less than 40, by separating conditional statements by a <code>,</code>. This performs an <em>AND</em> test so only rows that meet both conditions are returned.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(gapminder, country <span class="sc">==</span> <span class="st">"Zambia"</span>, lifeExp <span class="sc">&lt;</span> <span class="dv">40</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 0 √ó 6
# ‚Ñπ 6 variables: country &lt;chr&gt;, continent &lt;chr&gt;, year &lt;dbl&gt;, lifeExp &lt;dbl&gt;,
#   pop &lt;dbl&gt;, gdpPercap &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>You may have noticed that <code>filter</code> will always output the same number of columns as the input data frame. <code>filter</code> never changes the columns that are displayed. There are ways of using <code>filter</code> in conjunction with <code>select</code> as we will see later.</p>
</div>
</div>
</div>
<hr>
<hr>
<hr>
</section>
</section>
<section id="exercise" class="level2">
<h2 class="anchored" data-anchor-id="exercise">Exercise</h2>
<div class="exercise">
<ul>
<li>Create a subset of the data where the population less than a million in the year 2002</li>
<li>Create a subset of the data where the life expectancy is greater than 75 in the years prior to 1987</li>
<li>Create a subset of the European data where the life expectancy is between 75 and 80 in the years 2002 or 2007.</li>
<li>If you are finished with these, try to explore alternative ways of performing the same filtering</li>
</ul>
</div>
<hr>
<hr>
<hr>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solutions
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a subset of the data where the population less than a million in the year 2002</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(gapminder, pop <span class="sc">&lt;</span> <span class="fl">1e6</span>, year <span class="sc">==</span> <span class="dv">2002</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 √ó 6
  country           continent  year lifeExp    pop gdpPercap
  &lt;chr&gt;             &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;
1 Bahrain           Asia       2002    74.8 656397    23404.
2 Comoros           Africa     2002    63.0 614382     1076.
3 Djibouti          Africa     2002    53.4 447416     1908.
4 Equatorial Guinea Africa     2002    49.3 495627     7703.
5 Iceland           Europe     2002    80.5 288030    31163.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a subset of the data where the life expectancy is greater than 75 in the years prior to 1987</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(gapminder, lifeExp <span class="sc">&gt;</span> <span class="dv">75</span>, year <span class="sc">&lt;</span> <span class="dv">1987</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 √ó 6
  country          continent  year lifeExp       pop gdpPercap
  &lt;chr&gt;            &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
1 Canada           Americas   1982    75.8  25201900    22899.
2 Greece           Europe     1982    75.2   9786480    15268.
3 Hong Kong, China Asia       1982    75.4   5264500    14561.
4 Iceland          Europe     1977    76.1    221823    19655.
5 Iceland          Europe     1982    77.0    233997    23270.
6 Japan            Asia       1977    75.4 113872473    16610.
7 Japan            Asia       1982    77.1 118454974    19384.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a subset of the European data where the life expectancy is between 75 and 80 in the years 2002 or 2007</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(gapminder, continent <span class="sc">==</span> <span class="st">"Europe"</span>, lifeExp <span class="sc">&gt;</span> <span class="dv">75</span>, lifeExp <span class="sc">&lt;</span> <span class="dv">80</span> , year <span class="sc">==</span> <span class="dv">2002</span> <span class="sc">|</span> year <span class="sc">==</span> <span class="dv">2007</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20 √ó 6
   country        continent  year lifeExp      pop gdpPercap
   &lt;chr&gt;          &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
 1 Albania        Europe     2002    75.7  3508512     4604.
 2 Albania        Europe     2007    76.4  3600523     5937.
 3 Austria        Europe     2002    79.0  8148312    32418.
 4 Austria        Europe     2007    79.8  8199783    36126.
 5 Belgium        Europe     2002    78.3 10311970    30486.
 6 Belgium        Europe     2007    79.4 10392226    33693.
 7 Croatia        Europe     2007    75.7  4493312    14619.
 8 Czech Republic Europe     2002    75.5 10256295    17596.
 9 Czech Republic Europe     2007    76.5 10228744    22833.
10 Denmark        Europe     2002    77.2  5374693    32167.
11 Denmark        Europe     2007    78.3  5468120    35278.
12 Finland        Europe     2002    78.4  5193039    28205.
13 Finland        Europe     2007    79.3  5238460    33207.
14 France         Europe     2002    79.6 59925035    28926.
15 Germany        Europe     2002    78.7 82350671    30036.
16 Germany        Europe     2007    79.4 82400996    32170.
17 Greece         Europe     2002    78.3 10603863    22514.
18 Greece         Europe     2007    79.5 10706290    27538.
19 Ireland        Europe     2002    77.8  3879155    34077.
20 Ireland        Europe     2007    78.9  4109086    40676.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># A different version using a built-in dplyr function called between</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(gapminder, continent <span class="sc">==</span> <span class="st">"Europe"</span>, </span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>       <span class="fu">between</span>(lifeExp, <span class="dv">75</span>,<span class="dv">80</span>), </span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>       year <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2002</span>,<span class="dv">2007</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20 √ó 6
   country        continent  year lifeExp      pop gdpPercap
   &lt;chr&gt;          &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
 1 Albania        Europe     2002    75.7  3508512     4604.
 2 Albania        Europe     2007    76.4  3600523     5937.
 3 Austria        Europe     2002    79.0  8148312    32418.
 4 Austria        Europe     2007    79.8  8199783    36126.
 5 Belgium        Europe     2002    78.3 10311970    30486.
 6 Belgium        Europe     2007    79.4 10392226    33693.
 7 Croatia        Europe     2007    75.7  4493312    14619.
 8 Czech Republic Europe     2002    75.5 10256295    17596.
 9 Czech Republic Europe     2007    76.5 10228744    22833.
10 Denmark        Europe     2002    77.2  5374693    32167.
11 Denmark        Europe     2007    78.3  5468120    35278.
12 Finland        Europe     2002    78.4  5193039    28205.
13 Finland        Europe     2007    79.3  5238460    33207.
14 France         Europe     2002    79.6 59925035    28926.
15 Germany        Europe     2002    78.7 82350671    30036.
16 Germany        Europe     2007    79.4 82400996    32170.
17 Greece         Europe     2002    78.3 10603863    22514.
18 Greece         Europe     2007    79.5 10706290    27538.
19 Ireland        Europe     2002    77.8  3879155    34077.
20 Ireland        Europe     2007    78.9  4109086    40676.</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="manipulating-the-values-in-a-column-creating-new-columns" class="level2">
<h2 class="anchored" data-anchor-id="manipulating-the-values-in-a-column-creating-new-columns">Manipulating the values in a column / creating new columns</h2>
<p>As well as selecting existing columns in the data frame, new columns can be created and existing ones manipulated using the <code>mutate</code> function. Typically a function or mathematical expression is applied to data in existing columns by row, and the result either stored in a new column or reassigned to an existing one. In other words, the number of values returned by the function must be the same as the number of input values. Multiple mutations can be performed in one line of code.</p>
<p>Here, we create a new column of population in millions (<code>PopInMillions</code>) and round <code>lifeExp</code> to the nearest integer.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(gapminder, <span class="at">PopInMillions =</span> pop <span class="sc">/</span> <span class="fl">1e6</span>,</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">lifeExp =</span> <span class="fu">round</span>(lifeExp))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 862 √ó 7
   country     continent  year lifeExp      pop gdpPercap PopInMillions
   &lt;chr&gt;       &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;         &lt;dbl&gt;
 1 Afghanistan Asia       1952      29  8425333      779.          8.43
 2 Afghanistan Asia       1957      30  9240934      821.          9.24
 3 Afghanistan Asia       1962      32 10267083      853.         10.3 
 4 Afghanistan Asia       1967      34 11537966      836.         11.5 
 5 Afghanistan Asia       1972      36 13079460      740.         13.1 
 6 Afghanistan Asia       1977      38 14880372      786.         14.9 
 7 Afghanistan Asia       1982      40 12881816      978.         12.9 
 8 Afghanistan Asia       1987      41 13867957      852.         13.9 
 9 Afghanistan Asia       1992      42 16317921      649.         16.3 
10 Afghanistan Asia       1997      42 22227415      635.         22.2 
# ‚Ñπ 852 more rows</code></pre>
</div>
</div>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Something to think about
</div>
</div>
<div class="callout-body-container callout-body">
<p>In the previous code we created a new column called <code>PopInMillions</code>. Why does the following code now produce an error?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(gapminder, PopInMillions)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>This code shows what a data frame looks like with a new column called PopInMillions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(gapminder, <span class="at">PopInMillions =</span> pop <span class="sc">/</span> <span class="fl">1e6</span>,</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">lifeExp =</span> <span class="fu">round</span>(lifeExp))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 862 √ó 7
   country     continent  year lifeExp      pop gdpPercap PopInMillions
   &lt;chr&gt;       &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;         &lt;dbl&gt;
 1 Afghanistan Asia       1952      29  8425333      779.          8.43
 2 Afghanistan Asia       1957      30  9240934      821.          9.24
 3 Afghanistan Asia       1962      32 10267083      853.         10.3 
 4 Afghanistan Asia       1967      34 11537966      836.         11.5 
 5 Afghanistan Asia       1972      36 13079460      740.         13.1 
 6 Afghanistan Asia       1977      38 14880372      786.         14.9 
 7 Afghanistan Asia       1982      40 12881816      978.         12.9 
 8 Afghanistan Asia       1987      41 13867957      852.         13.9 
 9 Afghanistan Asia       1992      42 16317921      649.         16.3 
10 Afghanistan Asia       1997      42 22227415      635.         22.2 
# ‚Ñπ 852 more rows</code></pre>
</div>
</div>
<p>It does not alter the <code>gapminder</code> dataset itself. If we wanted to continue to work with <code>PopInMillions</code>, we would either need to create a new variable or overwrite the original <code>gapminder</code> dataset (not recommended)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>gapminder2 <span class="ot">&lt;-</span> <span class="fu">mutate</span>(gapminder, <span class="at">PopInMillions =</span> pop <span class="sc">/</span> <span class="fl">1e6</span>,</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">lifeExp =</span> <span class="fu">round</span>(lifeExp))</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(gapminder2, PopInMillions)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 862 √ó 1
   PopInMillions
           &lt;dbl&gt;
 1          8.43
 2          9.24
 3         10.3 
 4         11.5 
 5         13.1 
 6         14.9 
 7         12.9 
 8         13.9 
 9         16.3 
10         22.2 
# ‚Ñπ 852 more rows</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<p>Similar to <code>mutate</code>, if we want to rename existing columns, and not create any extra columns, we can use the <code>rename</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rename</span>(gapminder, <span class="at">GDP=</span>gdpPercap)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 862 √ó 6
   country     continent  year lifeExp      pop   GDP
   &lt;chr&gt;       &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;
 1 Afghanistan Asia       1952    28.8  8425333  779.
 2 Afghanistan Asia       1957    30.3  9240934  821.
 3 Afghanistan Asia       1962    32.0 10267083  853.
 4 Afghanistan Asia       1967    34.0 11537966  836.
 5 Afghanistan Asia       1972    36.1 13079460  740.
 6 Afghanistan Asia       1977    38.4 14880372  786.
 7 Afghanistan Asia       1982    39.9 12881816  978.
 8 Afghanistan Asia       1987    40.8 13867957  852.
 9 Afghanistan Asia       1992    41.7 16317921  649.
10 Afghanistan Asia       1997    41.8 22227415  635.
# ‚Ñπ 852 more rows</code></pre>
</div>
</div>
</section>
<section id="ordering-sorting" class="level2">
<h2 class="anchored" data-anchor-id="ordering-sorting">Ordering / sorting</h2>
<p>The whole data frame can be re-ordered according to the values in one column using the <code>arrange</code> function. So to order the table according to population size:-</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">arrange</span>(gapminder, pop)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 862 √ó 6
   country  continent  year lifeExp    pop gdpPercap
   &lt;chr&gt;    &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;
 1 Djibouti Africa     1952    34.8  63149     2670.
 2 Djibouti Africa     1957    37.3  71851     2865.
 3 Djibouti Africa     1962    39.7  89898     3021.
 4 Bahrain  Asia       1952    50.9 120447     9867.
 5 Djibouti Africa     1967    42.1 127617     3020.
 6 Bahrain  Asia       1957    53.8 138655    11636.
 7 Iceland  Europe     1952    72.5 147962     7268.
 8 Comoros  Africa     1952    40.7 153936     1103.
 9 Kuwait   Asia       1952    55.6 160000   108382.
10 Iceland  Europe     1957    73.5 165110     9244.
# ‚Ñπ 852 more rows</code></pre>
</div>
</div>
<p>The default is <code>smallest --&gt; largest</code> but we can change this using the <code>desc</code> function</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">arrange</span>(gapminder, <span class="fu">desc</span>(pop))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 862 √ó 6
   country continent  year lifeExp        pop gdpPercap
   &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt;
 1 China   Asia       2007    73.0 1318683096     4959.
 2 China   Asia       2002    72.0 1280400000     3119.
 3 China   Asia       1997    70.4 1230075000     2289.
 4 China   Asia       1992    68.7 1164970000     1656.
 5 India   Asia       2007    64.7 1110396331     2452.
 6 China   Asia       1987    67.3 1084035000     1379.
 7 India   Asia       2002    62.9 1034172547     1747.
 8 China   Asia       1982    65.5 1000281000      962.
 9 India   Asia       1997    61.8  959000000     1459.
10 China   Asia       1977    64.0  943455000      741.
# ‚Ñπ 852 more rows</code></pre>
</div>
</div>
<p><code>arrange</code> also works on character vectors, arrange them alpha-numerically.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">arrange</span>(gapminder, <span class="fu">desc</span>(country))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 862 √ó 6
   country continent  year lifeExp     pop gdpPercap
   &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;
 1 Kuwait  Asia       1952    55.6  160000   108382.
 2 Kuwait  Asia       1957    58.0  212846   113523.
 3 Kuwait  Asia       1962    60.5  358266    95458.
 4 Kuwait  Asia       1967    64.6  575003    80895.
 5 Kuwait  Asia       1972    67.7  841934   109348.
 6 Kuwait  Asia       1977    69.3 1140357    59265.
 7 Kuwait  Asia       1982    71.3 1497494    31354.
 8 Kuwait  Asia       1987    74.2 1891487    28118.
 9 Kuwait  Asia       1992    75.2 1418095    34933.
10 Kuwait  Asia       1997    76.2 1765345    40301.
# ‚Ñπ 852 more rows</code></pre>
</div>
</div>
<p>We can even order by more than one condition</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">arrange</span>(gapminder, year, pop)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 862 √ó 6
   country           continent  year lifeExp    pop gdpPercap
   &lt;chr&gt;             &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;
 1 Djibouti          Africa     1952    34.8  63149     2670.
 2 Bahrain           Asia       1952    50.9 120447     9867.
 3 Iceland           Europe     1952    72.5 147962     7268.
 4 Comoros           Africa     1952    40.7 153936     1103.
 5 Kuwait            Asia       1952    55.6 160000   108382.
 6 Equatorial Guinea Africa     1952    34.5 216964      376.
 7 Gambia            Africa     1952    30   284320      485.
 8 Gabon             Africa     1952    37.0 420702     4293.
 9 Botswana          Africa     1952    47.6 442308      851.
10 Guinea-Bissau     Africa     1952    32.5 580653      300.
# ‚Ñπ 852 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">arrange</span>(gapminder, year, continent, pop)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 862 √ó 6
   country                  continent  year lifeExp     pop gdpPercap
   &lt;chr&gt;                    &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;
 1 Djibouti                 Africa     1952    34.8   63149     2670.
 2 Comoros                  Africa     1952    40.7  153936     1103.
 3 Equatorial Guinea        Africa     1952    34.5  216964      376.
 4 Gambia                   Africa     1952    30    284320      485.
 5 Gabon                    Africa     1952    37.0  420702     4293.
 6 Botswana                 Africa     1952    47.6  442308      851.
 7 Guinea-Bissau            Africa     1952    32.5  580653      300.
 8 Congo, Rep.              Africa     1952    42.1  854885     2126.
 9 Central African Republic Africa     1952    35.5 1291695     1071.
10 Eritrea                  Africa     1952    35.9 1438760      329.
# ‚Ñπ 852 more rows</code></pre>
</div>
</div>
</section>
<section id="saving-data-frames" class="level2">
<h2 class="anchored" data-anchor-id="saving-data-frames">Saving data frames</h2>
<p>A final point on data frames is that we can write them to disk once we have done our data processing.</p>
<p>Let‚Äôs create a folder in which to store such processed, ‚Äúanalysis-ready‚Äù data for sharing</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="st">"out_data"</span>,<span class="at">showWarnings =</span> <span class="cn">FALSE</span>)</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="do">## showWarnings will stop a message from appearing if the directory already exists</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>byWealth <span class="ot">&lt;-</span> <span class="fu">arrange</span>(gapminder, <span class="fu">desc</span>(gdpPercap))</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="co"># check the output before writing</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(byWealth)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 √ó 6
  country continent  year lifeExp     pop gdpPercap
  &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;
1 Kuwait  Asia       1957    58.0  212846   113523.
2 Kuwait  Asia       1972    67.7  841934   109348.
3 Kuwait  Asia       1952    55.6  160000   108382.
4 Kuwait  Asia       1962    60.5  358266    95458.
5 Kuwait  Asia       1967    64.6  575003    80895.
6 Kuwait  Asia       1977    69.3 1140357    59265.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(byWealth, <span class="at">file =</span> <span class="st">"out_data/by_wealth.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We will now try an exercise that involves using several steps of these operations</p>
<hr>
<hr>
<hr>
</section>
<section id="exercise-1" class="level2">
<h2 class="anchored" data-anchor-id="exercise-1">Exercise</h2>
<div class="exercise">
<ul>
<li>Filter the data to include just observations from the year 2002</li>
<li>Re-arrange the table so that the countries from each continent are ordered according to decreasing wealth. i.e.&nbsp;the wealthiest countries first</li>
<li>Select all the columns apart from year</li>
<li>Write the data frame out to a file in <code>out_data/</code> folder</li>
</ul>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>gapminder2 <span class="ot">&lt;-</span> <span class="fu">filter</span>(gapminder, year <span class="sc">==</span> <span class="dv">2002</span>)</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>gapminder3 <span class="ot">&lt;-</span> <span class="fu">arrange</span>(gapminder2, continent, country, <span class="fu">desc</span>(gdpPercap))</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>gapminder4 <span class="ot">&lt;-</span> <span class="fu">select</span>(gapminder3, <span class="sc">-</span>year)</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(gapminder4, <span class="st">"out_data/gapminder_2002.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<hr>
<hr>
<hr>
</section>
<section id="piping" class="level2">
<h2 class="anchored" data-anchor-id="piping">‚ÄúPiping‚Äù</h2>
<p>As have have just seen, we will often need to perform an analysis, or clean a dataset, using several <code>dplyr</code> functions in sequence. e.g.&nbsp;filtering, mutating, then selecting columns of interest (possibly followed by plotting - see shortly).</p>
<p>As a small example; if we wanted to filter our results to just Europe the <code>continent</code> column becomes redundant so we might as well remove it.</p>
<p>The following is perfectly valid R code, but invites the user to make mistakes and copy-and-paste errors when writing it. We also have to create multiple copies of the same data frame, which would not be desirable for large datasets.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> <span class="fu">filter</span>(gapminder, continent <span class="sc">==</span> <span class="st">"Europe"</span>)</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>tmp2 <span class="ot">&lt;-</span> <span class="fu">select</span>(tmp, <span class="sc">-</span>continent)</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>tmp2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 192 √ó 5
   country  year lifeExp     pop gdpPercap
   &lt;chr&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;
 1 Albania  1952    55.2 1282697     1601.
 2 Albania  1957    59.3 1476505     1942.
 3 Albania  1962    64.8 1728137     2313.
 4 Albania  1967    66.2 1984060     2760.
 5 Albania  1972    67.7 2263554     3313.
 6 Albania  1977    68.9 2509048     3533.
 7 Albania  1982    70.4 2780097     3631.
 8 Albania  1987    72   3075321     3739.
 9 Albania  1992    71.6 3326498     2497.
10 Albania  1997    73.0 3428038     3193.
# ‚Ñπ 182 more rows</code></pre>
</div>
</div>
<p>In R, <code>dplyr</code> commands to be linked together and form a workflow. The symbol <code>%&gt;%</code> is pronounced <strong>then</strong>. With a <code>%&gt;%</code> the input to a function is assumed to be the output of the previous line. All the <code>dplyr</code> functions that we have seen so far take a data frame as an input and return an altered data frame as an output, so are amenable to this type of programming.</p>
<p>The example we gave of filtering just the European countries and removing the <code>continent</code> column becomes:-</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(gapminder, continent<span class="sc">==</span><span class="st">"Europe"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>continent)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 192 √ó 5
   country  year lifeExp     pop gdpPercap
   &lt;chr&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;
 1 Albania  1952    55.2 1282697     1601.
 2 Albania  1957    59.3 1476505     1942.
 3 Albania  1962    64.8 1728137     2313.
 4 Albania  1967    66.2 1984060     2760.
 5 Albania  1972    67.7 2263554     3313.
 6 Albania  1977    68.9 2509048     3533.
 7 Albania  1982    70.4 2780097     3631.
 8 Albania  1987    72   3075321     3739.
 9 Albania  1992    71.6 3326498     2497.
10 Albania  1997    73.0 3428038     3193.
# ‚Ñπ 182 more rows</code></pre>
</div>
</div>
<p>Hopefully you will agree that the code is much cleaner and easier to read and write.</p>
<hr>
<hr>
<hr>
<section id="exercise-2" class="level4">
<h4 class="anchored" data-anchor-id="exercise-2">Exercise</h4>
<div class="exercise">
<ul>
<li>Re-write your solution to the previous exercise, but using the <code>%&gt;%</code> symbol</li>
</ul>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-7-contents" aria-controls="callout-7" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-7" class="callout-7-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(gapminder, year <span class="sc">==</span> <span class="dv">2002</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(continent, <span class="fu">desc</span>(gdpPercap)) <span class="sc">%&gt;%</span> </span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>year) <span class="sc">%&gt;%</span> </span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(<span class="st">"out_data/gapminder_piped_2002.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p>We will leave <code>dplyr</code> for the moment (although it will never be far away from us, since it is such a fundamental tool‚Ä¶) and start to look at making some nice graphs to understand our data.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Ceci n‚Äôest pas une pipe
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <code>%&gt;%</code> operation was introduced as part of the <code>magrittr</code> package, which gets loaded automatically as part of <code>dplyr</code>. However, the <code>dplyr</code> package is quite large and involves a lot of dependencies. If you <em>only</em> wanted to use the <code>%&gt;%</code> and not any other part of <code>dplyr</code> it would be quite inefficient to load the entire <code>dplyr</code> package as part of your code.</p>
<p>An equivalent <code>|&gt;</code> operation is available as part of base R. This means you can use piping <em>without having to load the whole of <code>dplyr</code></em>. This is not an issue for these materials since we are working with <code>dplyr</code> quite a lot, but worth mentioning for completeness as you may see <code>|&gt;</code> used elsewhere. The code is <strong>exactly the same</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(gapminder, year <span class="sc">==</span> <span class="dv">2002</span>) <span class="sc">|&gt;</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(continent, <span class="fu">desc</span>(gdpPercap)) <span class="sc">|&gt;</span></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>year)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 71 √ó 5
   country           continent lifeExp      pop gdpPercap
   &lt;chr&gt;             &lt;chr&gt;       &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
 1 Gabon             Africa       56.8  1299304    12522.
 2 Botswana          Africa       46.6  1630347    11004.
 3 Equatorial Guinea Africa       49.3   495627     7703.
 4 Algeria           Africa       71.0 31287142     5288.
 5 Egypt             Africa       69.8 73312559     4755.
 6 Congo, Rep.       Africa       53.0  3328795     3484.
 7 Angola            Africa       41.0 10866106     2773.
 8 Cameroon          Africa       49.9 15929988     1934.
 9 Djibouti          Africa       53.4   447416     1908.
10 Cote d'Ivoire     Africa       46.8 16252726     1649.
# ‚Ñπ 61 more rows</code></pre>
</div>
</div>
</div>
</div>
<hr>
<hr>
<hr>
</section>
</section>
</section>
<section id="plotting" class="level1">
<h1>Plotting</h1>
<p>The R language has extensive graphical capabilities. Graphics in R may be created by many different methods including base graphics and more advanced plotting packages such as lattice.</p>
<p>The <code>ggplot2</code> package was created by Hadley Wickham and provides a intuitive plotting system to rapidly generate publication quality graphics.</p>
<p><code>ggplot2</code> builds on the concept of the ‚ÄúGrammar of Graphics‚Äù (Wilkinson 2005, Bertin 1983) which describes a consistent syntax for the construction of a wide range of complex graphics by a concise description of their components.</p>
<section id="why-use-ggplot2" class="level2">
<h2 class="anchored" data-anchor-id="why-use-ggplot2">Why use ggplot2?</h2>
<p>The structured syntax and high level of abstraction used by ggplot2 should allow for the user to concentrate on the visualisations instead of creating the underlying code.</p>
<p>On top of this central philosophy ggplot2 has:</p>
<ul>
<li>Increased flexibility over many plotting systems.</li>
<li>An advanced theme system for professional/publication level graphics.</li>
<li>Large developer base ‚Äì Many libraries extending its flexibility.</li>
<li>Large user base ‚Äì Great documentation and active mailing list.</li>
</ul>
<div class="callout callout-style-simple callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Top tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>It is always useful to think about the message you want to convey and the appropriate plot before writing any R code. Resources like <a href="https://www.data-to-viz.com/">data-to-viz.com</a> should help. Don‚Äôt be afraid to even sketch out the plot on paper or a whiteboard!</p>
</div>
</div>
<p>With some practice, <code>ggplot2</code> makes it easier to go from the figure you are imagining in our head (or on paper) to a publication-ready image in R.</p>
<div class="callout callout-style-simple callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Another ‚Äúcheatsheet‚Äù
</div>
</div>
<div class="callout-body-container callout-body">
<p>As with <code>dplyr</code>, we won‚Äôt have time to cover all details of <code>ggplot2</code>. This is however a useful <a href="https://raw.githubusercontent.com/rstudio/cheatsheets/main/data-visualization.pdf">cheatsheet</a> that can be printed as a reference. The cheatsheet is also available through the RStudio Help menu.</p>
</div>
</div>
</section>
<section id="basic-plot-types" class="level2">
<h2 class="anchored" data-anchor-id="basic-plot-types">Basic plot types</h2>
<p>A plot in <code>ggplot2</code> is created with the following type of command. N.B. please dont try and run this code, it just an overall sketch of what our <code>ggplot2</code> code will look like.</p>
<pre><code>ggplot(data = &lt;DATA&gt;, mapping = aes(&lt;MAPPINGS&gt;)) +  &lt;GEOM_FUNCTION&gt;()</code></pre>
<p>So we need to specify</p>
<ul>
<li>The data to be used in graph</li>
<li>Mappings of data to the graph (<em>aesthetic</em> mapping)</li>
<li>What type of graph we want to use (The <em>geom</em> to use).</li>
</ul>
<p>Lets say that we want to explore the relationship between GDP and Life Expectancy. We might start with the hypothesis that richer countries have higher life expectancy. A sensible choice of plot would be a <em>scatter plot</em> with gdp on the x-axis and life expectancy on the y-axis.</p>
<p>The first stage is to specify our dataset using the <code>data</code> argument. <code>ggplot2</code> is great, but not clever enough to know what kind of plot we might want. It just creates a blank canvas.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> gapminder)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>For the aesthetics, as a bare minimum we will map the <code>gdpPercap</code> and <code>lifeExp</code> to the x- and y-axis of the plot. Some progress is made; we at least get axes</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> gapminder,<span class="fu">aes</span>(<span class="at">x=</span>gdpPercap, <span class="at">y=</span>lifeExp))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-41-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>That created the axes, but we still need to define how to display our points on the plot. As we have continuous data for both the x- and y-axis, <code>geom_point</code> is a good choice.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> gapminder,<span class="fu">aes</span>(<span class="at">x=</span>gdpPercap, <span class="at">y=</span>lifeExp)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-42-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The <em>geom</em> we use will depend on what kind of data we have (continuous, categorical etc)</p>
<ul>
<li><code>geom_point()</code> - Scatter plots</li>
<li><code>geom_line()</code> - Line plots</li>
<li><code>geom_smooth()</code> - Fitted line plots</li>
<li><code>geom_bar()</code> - Bar plots</li>
<li><code>geom_boxplot()</code> - Boxplots</li>
<li><code>geom_jitter()</code> - Jitter to plots</li>
<li><code>geom_histogram()</code> - Histogram plots</li>
<li><code>geom_density()</code> - Density plots</li>
<li><code>geom_text()</code> - Text to plots</li>
<li><code>geom_errorbar()</code> - Errorbars to plots</li>
<li><code>geom_violin()</code> - Violin plots</li>
<li><code>geom_tile()</code> - for ‚Äúheatmap‚Äù-like plots</li>
</ul>
<p>Boxplots are commonly used to visualise the distributions of continuous data. We have to use a categorical variable on the x-axis such as <code>continent</code> or <code>country</code> (not advisable in this case as there are too many different values).</p>
<p>The order of the boxes along the x-axis is dictated by the order of categories in the factor; with the default for names being alphabetical order.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(gapminder, <span class="fu">aes</span>(<span class="at">x =</span> continent, <span class="at">y=</span>gdpPercap)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>A histogram is a common method for visualising a <em>distribution</em> of numeric values. Your data are split into a number of bins (which can be altered in the code) across the whole data range, and the number of observations in each bin is shown on the y-axis. Thus you can see where the majority of your data points are</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(gapminder, <span class="fu">aes</span>(<span class="at">x =</span> gdpPercap)) <span class="sc">+</span> <span class="fu">geom_histogram</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-44-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>For <em>categorical</em> data, e.g.&nbsp;the country of continent columns in our case, a barplot will show the number of times each category is observed. The <code>geom_bar</code> will do the job of counting and plotting.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(gapminder, <span class="fu">aes</span>(<span class="at">x=</span>continent)) <span class="sc">+</span> <span class="fu">geom_bar</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-45-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>If you have particular numeric values you want to display in a barplot you can use <code>geom_col</code>. To give an example we will first filter the data to a particular year and continent. The <code>gdpPercap</code> values for each country can then be plotted. In the below plot the axis labels will be messy and difficult to read. This is something that can be customised with some of the <code>ggplot2</code> options we will explore later.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>gapminder2002 <span class="ot">&lt;-</span> <span class="fu">filter</span>(gapminder, year<span class="sc">==</span><span class="dv">2002</span>,continent<span class="sc">==</span><span class="st">"Americas"</span>)</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Notice that we plot the variable we have just created and not gapminder</span></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a><span class="do">## You could also do this in one step using the piping technique for earlier</span></span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(gapminder2002, <span class="fu">aes</span>(<span class="at">x=</span>country,<span class="at">y=</span>gdpPercap)) <span class="sc">+</span> <span class="fu">geom_col</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-46-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Where appropriate, we can add multiple layers of <code>geom</code>s to the plot. For instance, a criticism of the boxplot is that it does not show all the data. We can rectify this by overlaying the individual points. This can give a representation of how many data points there are.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(gapminder, <span class="fu">aes</span>(<span class="at">x =</span> continent, <span class="at">y=</span>gdpPercap)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>() <span class="sc">+</span> <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-47-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>However, the default x-coordinate is always the same for each category. Adding some random ‚Äúnoise‚Äù to the x-axis can help using <code>geom_jitter</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(gapminder, <span class="fu">aes</span>(<span class="at">x =</span> continent, <span class="at">y=</span>gdpPercap)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>() <span class="sc">+</span> <span class="fu">geom_jitter</span>(<span class="at">width=</span><span class="fl">0.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-48-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<hr>
<hr>
<hr>
<section id="exercises" class="level3">
<h3 class="anchored" data-anchor-id="exercises">Exercises</h3>
<div class="exercise">
<ul>
<li>The violin plot is a popular alternative to the boxplot. Create a violin plot with <code>geom_violin</code> to visualise the differences in GDP between different continents.</li>
<li>Create a subset of the <code>gapminder</code> data frame containing just the rows for your country of birth</li>
<li>Has there been an increase in life expectancy over time?
<ul>
<li>visualise the trend using a scatter plot (<code>geom_point</code>), line graph (<code>geom_line</code>) or smoothed line (<code>geom_smooth</code>).</li>
</ul></li>
<li>What happens when you modify the <code>geom_boxplot</code> example to compare the gdp distributions for different years?
<ul>
<li>Look at the message <code>ggplot2</code> prints above the plot and try to modify the code to give a separate boxplot for each year</li>
</ul></li>
</ul>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-11-contents" aria-controls="callout-11" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-11" class="callout-11-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(gapminder, <span class="fu">aes</span>(<span class="at">x =</span> continent, <span class="at">y =</span> gdpPercap)) <span class="sc">+</span> <span class="fu">geom_violin</span>()</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a><span class="do">## I choose United Kingdom here, but pick a different one if you like</span></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>uk_data <span class="ot">&lt;-</span> <span class="fu">filter</span>(gapminder, country <span class="sc">==</span> <span class="st">"United Kingdom"</span>)</span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a><span class="do">## As a scatter plot</span></span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(uk_data, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> lifeExp)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a><span class="do">## As a line plot</span></span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(uk_data, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> lifeExp)) <span class="sc">+</span> <span class="fu">geom_line</span>()</span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-13"><a href="#cb90-13" aria-hidden="true" tabindex="-1"></a><span class="do">## With a smoothed line</span></span>
<span id="cb90-14"><a href="#cb90-14" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(uk_data, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> lifeExp)) <span class="sc">+</span> <span class="fu">geom_smooth</span>()</span>
<span id="cb90-15"><a href="#cb90-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-16"><a href="#cb90-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-17"><a href="#cb90-17" aria-hidden="true" tabindex="-1"></a><span class="do">## more than one of the above</span></span>
<span id="cb90-18"><a href="#cb90-18" aria-hidden="true" tabindex="-1"></a><span class="do">## You can also fit a straight line (via a linear model) by changing method</span></span>
<span id="cb90-19"><a href="#cb90-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-20"><a href="#cb90-20" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(uk_data, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> lifeExp)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>)</span>
<span id="cb90-21"><a href="#cb90-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-22"><a href="#cb90-22" aria-hidden="true" tabindex="-1"></a><span class="do">## this exercise could also make use of the piping technique</span></span>
<span id="cb90-23"><a href="#cb90-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-24"><a href="#cb90-24" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(gapminder, country <span class="sc">==</span> <span class="st">"United Kingdom"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb90-25"><a href="#cb90-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> lifeExp)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_smooth</span>()</span>
<span id="cb90-26"><a href="#cb90-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-27"><a href="#cb90-27" aria-hidden="true" tabindex="-1"></a><span class="co"># this is how we might expect the code to look like</span></span>
<span id="cb90-28"><a href="#cb90-28" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(gapminder, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> gdpPercap)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>()</span>
<span id="cb90-29"><a href="#cb90-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-30"><a href="#cb90-30" aria-hidden="true" tabindex="-1"></a><span class="co"># The previous output hints that you might want to group by year - otherwise it thinks that year is a numerical variable</span></span>
<span id="cb90-31"><a href="#cb90-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-32"><a href="#cb90-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-33"><a href="#cb90-33" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(gapminder, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> gdpPercap, <span class="at">group=</span>year)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>()</span>
<span id="cb90-34"><a href="#cb90-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-35"><a href="#cb90-35" aria-hidden="true" tabindex="-1"></a><span class="co"># You may sometimes see this as a possible solution which fixes the year to be a categorical variable</span></span>
<span id="cb90-36"><a href="#cb90-36" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(gapminder, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.factor</span>(year), <span class="at">y =</span> gdpPercap)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<hr>
<hr>
<hr>
<p>As we have seen already, <code>ggplot</code> offers an interface to create many popular plot types. It is up to the user to decide what the best way to visualise the data.</p>
</section>
</section>
<section id="customising-the-plot-appearance" class="level2">
<h2 class="anchored" data-anchor-id="customising-the-plot-appearance">Customising the plot appearance</h2>
<p>Our plots are a bit dreary at the moment, but one way to add colour is to add a <code>col</code> argument to the <code>geom_point</code> function. The value can be any of the pre-defined colour names in R. These are displayed in this <a href="http://www.stat.columbia.edu/~tzheng/files/Rcolor.pdf">handy online reference</a>. <em>R</em>ed, <em>G</em>reen, <em>B</em>lue of <em>Hex</em> values can also be given.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(gapminder, <span class="fu">aes</span>(<span class="at">x =</span> gdpPercap, <span class="at">y=</span>lifeExp)) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">col=</span><span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-50-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Use the Hex codes from Farrow and Ball: https://convertingcolors.com/list/farrow-ball.html</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a><span class="co"># (cook's blue)</span></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(gapminder, <span class="fu">aes</span>(<span class="at">x =</span> gdpPercap, <span class="at">y=</span>lifeExp)) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">col=</span><span class="st">"#6A90B4"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-51-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>However, whilst looking nicer this doesn‚Äôt really <strong>tell us anything</strong> about the data. For example, what are the points to the far right? Do they belong to a particular country or continent? A powerful feature of <code>ggplot2</code> is that colours are treated as aesthetics of the plot. In other words we can use a column in our dataset.</p>
<p>Let‚Äôs say that we want points on our plot to be coloured according to continent. We add an extra argument to the definition of aesthetics to define the mapping. <code>ggplot2</code> will even decide on colours and create a legend for us. Don‚Äôt worry if you don‚Äôt like the colours chosen, all of this can be customised.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(gapminder, <span class="fu">aes</span>(<span class="at">x =</span> gdpPercap, <span class="at">y=</span>lifeExp,<span class="at">col=</span>continent)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-52-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>It will even choose a continuous or discrete colour scale based on the data type. We have already seen that <code>ggplot2</code> is treating our <code>year</code> column as numerical data; which is probably not very useful for visualisation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(gapminder, <span class="fu">aes</span>(<span class="at">x =</span> gdpPercap, <span class="at">y=</span>lifeExp,<span class="at">col=</span>year)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-53-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We can force <code>ggplot2</code> to treat <code>year</code> as categorical data by using <code>as.factor</code> when creating the aesthetics.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(gapminder, <span class="fu">aes</span>(<span class="at">x =</span> gdpPercap, <span class="at">y=</span>lifeExp,<span class="at">col=</span><span class="fu">as.factor</span>(year))) <span class="sc">+</span> <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-54-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>When used in the construction of a boxplot, the <code>col</code> argument will change the colour of the lines. To change the colour of the boxes we have to use <code>fill</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(gapminder, <span class="fu">aes</span>(<span class="at">x =</span> continent, <span class="at">y=</span>gdpPercap,<span class="at">fill=</span>continent)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-55-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<hr>
<hr>
<hr>
</section>
<section id="wrap-up" class="level2">
<h2 class="anchored" data-anchor-id="wrap-up">Wrap-up</h2>
<p>We have covered a <em>lot</em> about manipulating and visualising data, but have only just scratched the surface. In the <a href="../..\training/r_part3/index.html">next part</a> we will conclude with</p>
<ul>
<li>Choosing colour palettes</li>
<li>(Some ways to) customise our plots</li>
<li>Automatically plot different subsets / categories in our data using ‚Äúfaceting‚Äù</li>
<li>Producing summary statistics from our data, and for different subsets / categories</li>
<li>Joining two data frames</li>
<li>(Briefly) how to clean ‚Äúmessy‚Äù data</li>
</ul>
</section>
<section id="bonus-exercise" class="level2">
<h2 class="anchored" data-anchor-id="bonus-exercise">Bonus Exercise</h2>
<p>These are a bit more challenging, but please feel free to have a go</p>
<ul>
<li>Using the <code>filter</code> function, find all countries that start with the letter Z
<ul>
<li>Hint: You can find the first letter of each country using the <code>substr</code> function. The <code>mutate</code> function can then be used to add a new column to the data.</li>
</ul></li>
<li>Use <code>geom_tile</code> to create a heatmap visualising life expectancy over time for European countries. You will need to work out what <code>aes</code>thetics to specify for a <code>geom_tile</code> plot</li>
</ul>
<p><img src="../..\files/training/r/tile_example.png" class="img-fluid"></p>
<hr>
<hr>
<hr>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-12-contents" aria-controls="callout-12" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-12" class="callout-12-contents callout-collapse collapse">
<section id="part-1" class="level3 callout-body-container callout-body">
<h3 class="anchored" data-anchor-id="part-1">Part 1</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="do">## month.name is a built-in vector of the months of the year</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>month.name</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a><span class="do">## substr can be used to extract substrings from a character vector betwen a start and end position</span></span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a><span class="do">## e.g. print the first three letters of each moth</span></span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-8"><a href="#cb97-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-9"><a href="#cb97-9" aria-hidden="true" tabindex="-1"></a><span class="fu">substr</span>(month.name, <span class="dv">1</span>, <span class="dv">3</span>)</span>
<span id="cb97-10"><a href="#cb97-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-11"><a href="#cb97-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Using mutate, add an extra column; the first letter of each country name. </span></span>
<span id="cb97-12"><a href="#cb97-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-13"><a href="#cb97-13" aria-hidden="true" tabindex="-1"></a>gapminder2 <span class="ot">&lt;-</span> <span class="fu">mutate</span>(gapminder, <span class="at">FirstLetter =</span> <span class="fu">substr</span>(country, <span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb97-14"><a href="#cb97-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-15"><a href="#cb97-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Now filter using the new FirstLetter column</span></span>
<span id="cb97-16"><a href="#cb97-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-17"><a href="#cb97-17" aria-hidden="true" tabindex="-1"></a>gapminder3 <span class="ot">&lt;-</span> <span class="fu">filter</span>(gapminder2, FirstLetter <span class="sc">==</span> <span class="st">"Z"</span>)</span>
<span id="cb97-18"><a href="#cb97-18" aria-hidden="true" tabindex="-1"></a>gapminder3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Get the European countries</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(gapminder, continent <span class="sc">==</span> <span class="st">"Europe"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a><span class="do">## make heatmap. See the fill aesthetic to be life expectancy</span></span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>year,<span class="at">y=</span>country,<span class="at">fill=</span>lifeExp)) <span class="sc">+</span> <span class="fu">geom_tile</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "Óßã";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>